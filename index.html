<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=0.8, user-scalable=no">
  <title>üóíÔ∏è</title>
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1e50c7;
      --bg-light: #f1f5f9;
      --card-bg: #ffffff;
      --text: #1e293b;
      --border-color: #e2e8f0;
      --white: #ffffff;
      --radius-md: 10px;
      --radius-sm: 6px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
      --error: #dc2626;
      --success: #16a34a;
      --warning: #d97706;
      --info: #0284c7;
    }
    
    body.dark-mode {
      --bg-light: #131313;
      --card-bg: #333436;
      --text: #f8fafc;
      --border-color: #555555;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
    }
    
    body {
      background: var(--bg-light);
      color: var(--text);
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 0;
      transition: all 0.3s;
    }
    
    .main-container {
      max-width: 1400px;
      margin: 1rem auto;
      padding: 0 1rem;
    }
    
    .channels-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
      width: 100%;
    }
    
    .channel-group {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 0;
      margin-bottom: 1rem;
      box-shadow: var(--shadow-sm);
      overflow: hidden;
    }
    
    .channel-group__content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 0.8rem;
      padding: 0.8rem;
      width: 100%;
      box-sizing: border-box;
    }
    
    .channel-card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      padding: 0.8rem;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
      transition: all 0.2s;
      position: relative;
      user-select: none;
      min-height: 100px;
      width: 100%;
      box-sizing: border-box;
    }
    
    .app-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 1rem;
    }
    
    .app-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .header-actions {
      display: flex;
      gap: 0.5rem;
    }
    
    .search-filters {
      background: var(--card-bg);
      border-radius: var(--radius-md);
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: var(--shadow-sm);
    }
    
    .search-box {
      position: relative;
      margin-bottom: 0.8rem;
    }
    
    .search-box input {
      width: 100%;
      padding: 0.6rem 1rem 0.6rem 2.2rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      background-color: var(--card-bg);
      color: var(--text);
      box-sizing: border-box;
    }
    
    .search-box::before {
      content: "üîç";
      position: absolute;
      left: 0.8rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text);
      font-size: 0.9rem;
    }
    
    .filter-buttons {
      display: flex;
      gap: 0.6rem;
      margin-top: 0.8rem;
    }
    
    .filter-button {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      background: var(--card-bg);
      color: var(--text);
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .filter-button:hover {
      border-color: var(--primary);
    }
    
    .filter-button--active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .filter-button--favorites, .filter-button--clear {
      flex: 0 0 auto;
      width: 36px;
      min-width: 36px;
      padding: 0.5rem 0;
    }
    
    .emoji-filters {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    
    .emoji-filter-btn {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      font-size: 18px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    .emoji-filter-btn:hover {
      border-color: var(--primary);
    }
    
    .emoji-filter-btn--active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .channel-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-color: var(--primary);
    }
    
    .channel-card--favorite {
      border: 2px solid var(--primary);
    }
    
    .channel-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }
    
    .channel-name {
      font-weight: 600;
      flex-grow: 1;
      padding: 0 0.5rem;
      text-align: center;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }
    
    .channel-number {
      color: var(--primary);
      font-weight: 600;
      font-size: 0.75rem;
    }
    
    .channel-time {
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .channel-time--live::before, .channel-name--live::before {
      content: "";
      display: inline-block;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: #dc2626;
      animation: pulse 1.5s infinite;
    }
    
    .channel-event {
      font-size: 0.8rem;
      margin-top: 0.5rem;
    }
    
    .channel-sport {
      font-size: 1.2rem;
      margin-top: 0.2rem;
    }
    
    .channel-language {
      position: absolute;
      top: 0.5rem;
      right: 0.5rem;
      font-size: 0.7rem;
      background: rgba(37, 99, 235, 0.1);
      padding: 0.2rem 0.4rem;
      border-radius: var(--radius-sm);
    }
    
    .channel-rating {
      position: absolute;
      bottom: 0.5rem;
      right: 0.5rem;
      font-size: 0.7rem;
      color: var(--warning);
    }
    
    .player-section {
      position: relative;
    }
    
    .player-container {
      background: black;
      border-radius: var(--radius-md);
      overflow: hidden;
      width: 100%;
      height: 400px;
      display: none;
      position: relative;
      transition: all 0.3s ease;
    }
    
    .player-container--active {
      display: block;
      animation: tvOn 0.5s ease;
    }
    
    .player-container--minimized {
      width: 320px;
      height: 180px;
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 100;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      cursor: move;
    }
    
    #videoFrame {
      width: 100%;
      height: 100%;
      border: none;
      object-fit: cover;
    }
    
    .player-controls {
      display: none;
      gap: 10px;
      justify-content: center;
      padding: 10px;
      background: var(--card-bg);
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-sm);
      position: relative;
      margin-bottom: 10px;
    }
    
    .player-controls--active {
      display: flex;
    }
    
    .player-controls--minimized {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 320px;
      z-index: 100;
      cursor: move;
    }
    
    .control-btn {
      background: var(--primary);
      border: none;
      color: white;
      cursor: pointer;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    
    .control-btn:hover {
      background: var(--primary-dark);
    }
    
    .control-btn--active {
      background: var(--primary-dark);
    }
    
    .channel-info {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.9rem;
      font-weight: 600;
      max-width: 150px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      cursor: move;
      user-select: none;
    }
    
    .channel-number-display {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.9rem;
      font-weight: 600;
    }
    
    .channel-group__header {
      padding: 0.8rem 1rem;
      background: rgba(var(--primary-rgb), 0.1);
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
    }
    
    .channel-group__header--collapsed {
      border-bottom: none;
    }
    
    .channel-group__title {
      font-weight: 600;
      color: var(--text);
    }
    
    .channel-group__sport {
      font-size: 0.8rem;
      color: var(--primary);
      margin-top: 0.2rem;
    }
    
    .channel-group__content--collapsed {
      display: none;
    }
    
    .no-results {
      text-align: center;
      padding: 2rem;
      color: var(--text);
      opacity: 0.7;
      font-size: 1.1rem;
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    
    .modal--active {
      display: flex;
    }
    
    .modal-content {
      background: var(--card-bg);
      border-radius: var(--radius-md);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 1.5rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      animation: modalFadeIn 0.3s ease;
      display: flex;
      flex-direction: column;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }
    
    .modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--primary);
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text);
    }
    
    .settings-section {
      margin-bottom: 1.5rem;
    }
    
    .settings-section-title {
      font-weight: 600;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .settings-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .settings-option:last-child {
      border-bottom: none;
    }
    
    .settings-option-label {
      flex: 1;
    }
    
    .settings-option-description {
      font-size: 0.8rem;
      color: var(--text);
      opacity: 0.7;
      margin-top: 0.3rem;
    }
    
    .color-picker {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    
    .color-option {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
    }
    
    .color-option--active {
      border-color: var(--text);
    }
    
    .form-group {
      margin-bottom: 1rem;
    }
    
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .form-input {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      background: var(--card-bg);
      color: var(--text);
    }
    
    .form-select {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      background: var(--card-bg);
      color: var(--text);
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }
    
    .btn {
      padding: 0.6rem 1rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn:hover {
      transform: scale(1.02);
    }
    
    .btn-primary {
      background: var(--primary);
      color: white;
      border: none;
    }
    
    .btn-primary:hover {
      background: var(--primary-dark);
    }
    
    .btn-secondary {
      background: var(--card-bg);
      color: var(--text);
      border: 1px solid var(--border-color);
    }
    
    .btn-secondary:hover {
      border-color: var(--primary);
    }
    
    .btn-danger {
      background: var(--error);
      color: white;
      border: none;
    }
    
    .btn-danger:hover {
      background: #b91c1c;
    }
    
    .import-export-tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
      margin-bottom: 1rem;
    }
    
    .import-export-tab {
      padding: 0.5rem 1rem;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    
    .import-export-tab--active {
      border-bottom-color: var(--primary);
      color: var(--primary);
      font-weight: 500;
    }
    
    .import-export-content {
      display: none;
    }
    
    .import-export-content--active {
      display: block;
    }
    
    .json-textarea {
      width: 100%;
      min-height: 200px;
      padding: 0.8rem;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-sm);
      background: var(--card-bg);
      color: var(--text);
      font-family: monospace;
      margin-bottom: 1rem;
    }
    
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 0.8rem 1rem;
      border-radius: var(--radius-sm);
      background: var(--card-bg);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .notification--success {
      border-left: 4px solid var(--success);
    }
    
    .notification--error {
      border-left: 4px solid var(--error);
    }
    
    .notification--active {
      transform: translateY(0);
      opacity: 1;
    }
    
    .scroll-to-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
      z-index: 999;
    }
    
    .scroll-to-top--visible {
      opacity: 1;
      visibility: visible;
    }
    
    .star {
      cursor: pointer;
      font-size: 1.5rem;
      color: #ccc;
      transition: color 0.2s;
    }
    
    .star.active {
      color: var(--warning);
    }
    
    .confirm-dialog {
      background: var(--card-bg);
      border-radius: var(--radius-md);
      padding: 1.5rem;
      max-width: 400px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .confirm-dialog p {
      margin-bottom: 1.5rem;
    }
    
    .confirm-dialog-buttons {
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    
    .delete-btn {
      position: absolute;
      top: 5px;
      left: 5px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--error);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 10;
      border: none;
      display: none;
    }
    
    .edit-btn {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 10;
      border: none;
      display: none;
    }
    
    .channel-card--edit-mode .delete-btn,
    .channel-card--edit-mode .edit-btn {
      display: flex;
    }
    
    .channel-card--edit-mode:hover .delete-btn,
    .channel-card--edit-mode:hover .edit-btn {
      opacity: 1;
    }
    
    .channel-card--edit-mode {
      cursor: pointer;
      border: 2px dashed var(--warning);
    }
    
    .import-gist-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 0.6rem 1rem;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    
    .import-gist-btn:hover {
      background: var(--primary-dark);
    }
    
    .save-edit-btn {
      position: fixed;
      bottom: 120px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--success);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      z-index: 999;
      border: none;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }
    
    .save-edit-btn--visible {
      opacity: 1;
      visibility: visible;
    }
    
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 26px;
    }
    
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 26px;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    input:checked + .slider {
      background-color: var(--primary);
    }
    
    input:checked + .slider:before {
      transform: translateX(24px);
    }
    
    /* Nuevos estilos para el modal de configuraci√≥n */
    .settings-modal__body {
      display: flex;
      flex-direction: row;
      gap: 1.5rem;
    }

    .settings-tabs {
      width: 180px;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    .settings-tab {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 15px;
      border-left: 3px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }

    .settings-tab:hover {
      opacity: 0.7;
    }

    .settings-tab--active {
      border-left-color: var(--primary);
      background: rgba(var(--primary-rgb), 0.05);
      color: var(--primary);
      font-weight: 600;
      opacity: 1;
    }

    .settings-tab span {
      font-size: 1rem;
    }

    .settings-content-wrapper {
      flex-grow: 1;
    }

    .settings-tab-content {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    .settings-tab-content--active {
      display: block;
    }

    .theme-selector {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .theme-selector button {
      flex: 1;
      padding: 0.6rem 1rem;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border-color);
      background: var(--card-bg);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }

    .theme-selector button:hover {
      border-color: var(--primary);
      transform: scale(1.02);
    }
    
    .theme-selector button.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .btn-secondary.icon-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .zone-peligro {
      margin-top: 2rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border-color);
    }

    .zone-peligro-title {
      font-weight: 600;
      color: var(--error);
      margin-bottom: 1rem;
    }

    .form-input[type="number"] {
      width: 100px;
    }
    
    .edit-modal-content {
      padding: 1.5rem;
    }
    
    .edit-modal-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .edit-modal-section-title {
      font-weight: 600;
      margin-top: 2rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .edit-modal-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.8rem 0;
      border-bottom: 1px solid var(--border-color);
    }
    
    .edit-modal-option:last-of-type {
      border-bottom: none;
    }
    
    .edit-modal-option-label {
      flex-grow: 1;
    }
    
    .edit-modal-option-label .description {
      font-size: 0.8rem;
      opacity: 0.7;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.3; }
      100% { opacity: 1; }
    }
    
    @keyframes tvOn {
      0% { opacity: 0; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    @keyframes modalFadeIn {
      0% { opacity: 0; transform: translateY(-20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @media (max-width: 768px) {
      .channels-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
      
      .filter-buttons {
        flex-wrap: wrap;
      }
      
      .channel-group__content {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
      
      .channel-group__content .channel-card:last-child:nth-child(3n+1) {
        grid-column: 1 / -1;
      }
      
      .channel-group__content .channel-card:last-child:nth-child(3n+2),
      .channel-group__content .channel-card:nth-last-child(2):nth-child(3n+1) {
        grid-column: span 1;
      }
      
      .channel-info, .channel-number-display {
        position: static;
        transform: none;
        font-size: 0.75rem;
        max-width: 30%;
      }
      
      .channel-info {
        text-align: left;
        flex: 1;
      }
      
      .channel-number-display {
        text-align: right;
        margin-left: auto;
      }
      
      .player-container {
        height: 400px;
      }
      
      .player-container--minimized {
        width: 280px;
        height: 157.5px;
        bottom: 70px;
      }
      
      .player-controls--minimized {
        width: 280px;
      }

      .settings-modal__body {
        flex-direction: column;
      }

      .settings-tabs {
        width: 100%;
        flex-direction: row;
        overflow-x: auto;
        border-bottom: 1.5px solid var(--border-color);
        margin-bottom: 1rem;
      }

      .settings-tab {
        border-left: none;
        border-bottom: 3px solid transparent;
      }

      .settings-tab--active {
        border-bottom-color: var(--primary);
        background: none;
      }
    }
    
    @media (min-width: 768px) {
      .channel-name {
        font-size: 0.9rem;
      }
      
      .channel-event {
        font-size: 0.8rem;
      }
      
      .channel-sport {
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <div class="main-container">
    
    <div class="player-section" id="playerSection">
      <div class="player-container" id="playerContainer">
        <iframe id="videoFrame" frameborder="0" allowfullscreen></iframe>
      </div>
      <div class="player-controls" id="playerControls">
        <span class="channel-info" id="channelInfo"></span>
        <button class="control-btn" id="prevChannelBtn" title="Reducir tama√±o">‚ñ≤</button>
        <button class="control-btn" id="nextChannelBtn" title="Aumentar tama√±o">‚ñº</button>
        <button class="control-btn" id="toggleStickyBtn" title="Fijar reproductor">‚õä</button>
        <button class="control-btn" id="favoriteBtn" title="Guardar favorito">‚òÖ</button>
        <button class="control-btn" id="closePlayerBtn" title="Cerrar">√ó</button>
        <span class="channel-number-display" id="channelNumberDisplay"></span>
      </div>
    </div>
    
    <div class="search-filters">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Buscar canales, n√∫mero (ej: #123) o hora (ej: 15:30)">
      </div>
      <div class="filter-buttons">
        <button class="filter-button filter-button--favorites" id="filterFavorites">‚òÖ</button>
        <button class="filter-button filter-button--active" id="filterWeb">V√≠a Web</button>
        <button class="filter-button" id="filterAcestream">Acestream</button>
        <button class="filter-button" id="filterSources">Fuentes</button>
        <button class="filter-button filter-button--clear" id="clearFilters">x</button>
      </div>
      <div class="emoji-filters" id="emojiFilters">
        <button class="emoji-filter-btn" data-filter="F1" title="F1">üèéÔ∏è</button>
        <button class="emoji-filter-btn" data-filter="F√∫tbol" title="F√∫tbol">‚öΩ</button>
        <button class="emoji-filter-btn" data-filter="Baloncesto" title="Baloncesto">üèÄ</button>
        <button class="emoji-filter-btn" data-filter="Motorsport" title="Motorsport">üèÅ</button>
        <button class="emoji-filter-btn" data-filter="ES" title="Espa√±ol">üá™üá∏</button>
        <button class="emoji-filter-btn" data-filter="EN" title="Ingl√©s">üá¨üáß</button>
      </div>
    </div>
    
    <div id="channelsContent"></div>
    
    <div class="no-results" id="noResults" style="display: none;">
      No se encontraron resultados. Prueba con otros filtros.
    </div>
    
    <button class="save-edit-btn" id="saveEditBtn" title="Guardar cambios">‚úì</button>
    
    <div class="modal" id="settingsModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">Configuraci√≥n</h2>
          <button class="modal-close" id="closeSettingsModal">&times;</button>
        </div>
        
        <div class="settings-modal__body">
          <div class="settings-tabs">
            <div class="settings-tab settings-tab--active" data-tab="general">
              <span>‚öôÔ∏è</span>
              <span>General</span>
            </div>
            <div class="settings-tab" data-tab="apariencia">
              <span>üé®</span>
              <span>Apariencia</span>
            </div>
            <div class="settings-tab" data-tab="reproductor">
              <span>üì∫</span>
              <span>Reproductor</span>
            </div>
            <div class="settings-tab" data-tab="datos">
              <span>üíæ</span>
              <span>Datos</span>
            </div>
          </div>

          <div class="settings-content-wrapper">
            <div class="settings-tab-content settings-tab-content--active" id="generalTab">
              <div class="settings-section">
                <h3 class="settings-section-title">‚öôÔ∏è General</h3>
                <div class="settings-option">
                  <div class="settings-option-label">
                    Permitir edici√≥n de canales
                    <div class="settings-option-description">Activa/desactiva el modo para reorganizar canales</div>
                  </div>
                  <label class="switch">
                    <input type="checkbox" id="editModeToggle">
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="settings-option">
                  <div class="settings-option-label">
                    Mostrar notificaciones
                    <div class="settings-option-description">Muestra mensajes al realizar acciones</div>
                  </div>
                  <label class="switch">
                    <input type="checkbox" id="notificationToggle" checked>
                    <span class="slider"></span>
                  </label>
                </div>
              </div>
            </div>

            <div class="settings-tab-content" id="aparienciaTab">
              <div class="settings-section">
                <h3 class="settings-section-title">üé® Apariencia</h3>
                <div class="form-group">
                  <label class="form-label">Selector de tema</label>
                  <div class="theme-selector" id="themeSelector">
                    <button data-theme="light">‚òÄÔ∏è Claro</button>
                    <button data-theme="dark">üåô Oscuro</button>
                    <button data-theme="system">üíª Sistema</button>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Color principal</label>
                  <div class="color-picker" id="colorPicker">
                    <div class="color-option color-option--active" style="background: #2563eb;" data-color="#2563eb"></div>
                    <div class="color-option" style="background: #dc2626;" data-color="#dc2626"></div>
                    <div class="color-option" style="background: #16a34a;" data-color="#16a34a"></div>
                    <div class="color-option" style="background: #d97706;" data-color="#d97706"></div>
                    <div class="color-option" style="background: #7c3aed;" data-color="#7c3aed"></div>
                    <div class="color-option" style="background: #db2777;" data-color="#db2777"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="settings-tab-content" id="reproductorTab">
              <div class="settings-section">
                <h3 class="settings-section-title">üì∫ Reproductor</h3>
                <div class="settings-option">
                  <div class="settings-option-label">
                    Recordar tama√±o del reproductor
                    <div class="settings-option-description">Guarda la √∫ltima altura del reproductor</div>
                  </div>
                  <label class="switch">
                    <input type="checkbox" id="rememberPlayerSize" checked>
                    <span class="slider"></span>
                  </label>
                </div>
                <div class="settings-option">
                  <div class="settings-option-label">
                    Reproducci√≥n autom√°tica
                    <div class="settings-option-description">Inicia la reproducci√≥n al seleccionar un canal</div>
                  </div>
                  <label class="switch">
                    <input type="checkbox" id="autoPlayToggle" checked>
                    <span class="slider"></span>
                  </label>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Tama√±o predeterminado</label>
                <input type="number" class="form-input" id="defaultPlayerSize" value="400" min="200" max="1000">
              </div>
            </div>

            <div class="settings-tab-content" id="datosTab">
              <div class="settings-section">
                <h3 class="settings-section-title">üíæ Gesti√≥n de Datos</h3>
                <div class="form-group">
                  <label class="form-label">Exportar datos (JSON)</label>
                  <textarea class="json-textarea" id="exportLinksData" readonly></textarea>
                  <div class="form-actions" style="justify-content: flex-start;">
                    <button class="btn btn-primary" id="copyExportLinksBtn">üìã Copiar JSON</button>
                    <button class="btn btn-secondary" id="downloadExportLinksBtn">‚§ì Descargar</button>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Importar datos (JSON)</label>
                  <textarea class="json-textarea" id="importLinksData" placeholder="Pega JSON aqu√≠"></textarea>
                  <div class="form-actions" style="justify-content: flex-start;">
                    <button class="btn btn-secondary" id="cancelImportBtn">Cancelar</button>
                    <button class="btn btn-primary" id="importLinksBtn">Importar</button>
                  </div>
                  <div class="form-actions" style="justify-content: flex-start; margin-top: 1rem;">
                    <button class="btn btn-secondary icon-btn" id="importGistBtn">
                      <span>üêô</span>
                      <span>GitHub Gist</span>
                    </button>
                    <button class="btn btn-secondary icon-btn" id="importFileBtn">
                      <span>üìÅ</span>
                      <span>Archivo JSON</span>
                    </button>
                  </div>
                </div>
              </div>
              <div class="zone-peligro">
                <h3 class="zone-peligro-title">Zona Peligro</h3>
                <button class="btn btn-danger" id="clearAllBtn">üóëÔ∏è Borrar Todos los Datos</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal" id="editLinkModal">
      <div class="modal-content edit-modal-content">
        <div class="modal-header">
          <h2 class="edit-modal-title">‚úèÔ∏è Editar Enlace</h2>
          <button class="modal-close" id="closeEditLinkModal">&times;</button>
        </div>
        
        <div class="form-group">
          <label class="form-label">URL del enlace</label>
          <input type="text" class="form-input" id="editLinkUrl" placeholder="https://ejemplo.com/stream">
        </div>
        
        <div class="form-group">
          <label class="form-label">T√≠tulo</label>
          <input type="text" class="form-input" id="editLinkTitle" placeholder="Nombre del canal o evento">
        </div>
        
        <div class="form-group">
          <label class="form-label">Web de origen (opcional)</label>
          <input type="text" class="form-input" id="editWebName" placeholder="Ej: Movistar, DAZN...">
        </div>
        
        <div class="form-group">
          <label class="form-label">Color de borde (opcional)</label>
          <input type="color" class="form-input" id="editLinkColor" value="#2563eb">
        </div>

        <h3 class="edit-modal-section-title">Opciones Adicionales</h3>

        <div class="edit-modal-option">
          <div class="edit-modal-option-label">
            Deporte
            <div class="description">Selecciona el icono de deporte</div>
          </div>
          <select class="form-select" id="editLinkSport" style="width: auto;">
            <option value="F1">üèéÔ∏è F1</option>
            <option value="Baloncesto">üèÄ Baloncesto</option>
            <option value="F√∫tbol">‚öΩ F√∫tbol</option>
            <option value="Motorsport">üèÅ Motorsport</option>
            <option value="Tenis">üéæ Tenis</option>
            <option value="TV">üì∫ TV</option>
            <option value="Otros">üèÖ Otros</option>
          </select>
        </div>
        
        <div class="edit-modal-option">
          <div class="edit-modal-option-label">
            Idioma
            <div class="description">Idioma del enlace</div>
          </div>
          <select class="form-select" id="editLinkLanguage" style="width: auto;">
            <option value="ES">Espa√±ol üá™üá∏</option>
            <option value="EN">Ingl√©s üá¨üáß</option>
            <option value="OT">Otro üè≥Ô∏è‚Äç‚ößÔ∏è</option>
          </select>
        </div>
        
        <div class="edit-modal-option">
          <div class="edit-modal-option-label">
            Tipo de enlace
            <div class="description">Define la fuente del stream</div>
          </div>
          <select class="form-select" id="editLinkType" style="width: auto;">
            <option value="web">V√≠a Web</option>
            <option value="acestream">Acestream</option>
            <option value="source">Fuente</option>
          </select>
        </div>
        
        <div class="edit-modal-option">
          <div class="edit-modal-option-label">
            Abrir en reproductor
            <div class="description">Si est√° desactivado, abre en una nueva pesta√±a</div>
          </div>
          <label class="switch">
            <input type="checkbox" id="editOpenInPlayer">
            <span class="slider"></span>
          </label>
        </div>
        
        <div class="edit-modal-option">
          <div class="edit-modal-option-label">
            Favorito
            <div class="description">Marcar como favorito</div>
          </div>
          <label class="switch">
            <input type="checkbox" id="editFavorito">
            <span class="slider"></span>
          </label>
        </div>

        <div class="form-group" style="margin-top: 1rem;">
          <label class="form-label">Puntuaci√≥n (1-5)</label>
          <div class="rating-stars" id="editRatingStars">
            <span class="star" data-value="1">‚òÖ</span>
            <span class="star" data-value="2">‚òÖ</span>
            <span class="star" data-value="3">‚òÖ</span>
            <span class="star" data-value="4">‚òÖ</span>
            <span class="star" data-value="5">‚òÖ</span>
          </div>
        </div>
        
        <div class="form-actions">
          <button class="btn btn-secondary" id="cancelEditLinkBtn">Cancelar</button>
          <button class="btn btn-primary" id="saveEditLinkBtn">Guardar Cambios</button>
        </div>
      </div>
    </div>
    
    <div class="modal" id="confirmClearModal">
      <div class="confirm-dialog">
        <h3>¬øEst√°s seguro?</h3>
        <p>Esta acci√≥n borrar√° todos los enlaces y la configuraci√≥n. Esta acci√≥n no se puede deshacer.</p>
        <div class="confirm-dialog-buttons">
          <button class="btn btn-secondary" id="cancelClearBtn">Cancelar</button>
          <button class="btn btn-danger" id="confirmClearBtn">Borrar Todo</button>
        </div>
      </div>
    </div>
    
    <div class="modal" id="confirmDeleteModal">
      <div class="confirm-dialog">
        <h3>¬øBorrar este enlace?</h3>
        <p>Esta acci√≥n no se puede deshacer.</p>
        <div class="confirm-dialog-buttons">
          <button class="btn btn-secondary" id="cancelDeleteBtn">Cancelar</button>
          <button class="btn btn-danger" id="confirmDeleteBtn">Borrar</button>
        </div>
      </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <div class="scroll-to-top" id="scrollToTop">‚Üë</div>
  </div>

  <script>
    const state = {
      links: [
        {
          id: '1',
          link: 'https://example.com/stream1',
          title: 'Canal 1',
          webName: 'Movistar',
          deporte: 'F√∫tbol',
          type: 'web',
          idioma: 'ES',
          color: '#2563eb',
          openInPlayer: true,
          puntuacion: 4,
          favorito: false
        },
        {
          id: '2',
          link: 'https://example.com/stream2',
          title: 'Canal 2',
          webName: 'DAZN',
          deporte: 'F1',
          type: 'web',
          idioma: 'EN',
          color: '#dc2626',
          openInPlayer: false,
          puntuacion: 3,
          favorito: true
        }
      ],
      settings: {
        darkMode: false,
        primaryColor: '#2563eb',
        rememberPlayerSize: true,
        playerHeight: 400,
        minimizedPlayerHeight: 180,
        minimizedPlayerWidth: 320,
        expandedGroups: {},
        editMode: false,
        notificationsEnabled: true,
        autoPlay: true,
        defaultPlayerSize: 400,
        theme: 'system'
      },
      filters: {
        searchText: '',
        type: 'web',
        sport: null,
        language: null,
        favoritesOnly: false
      },
      currentPlayer: {
        channelId: null,
        isSticky: false,
        isMinimized: false,
        isExpanded: false
      },
      deleteState: {
        linkId: null
      },
      editState: {
        linkId: null
      },
      filterClicks: {
        lastClickedButton: null,
        count: 0,
        lastClickTime: 0
      },
      dragState: {
        isDragging: false,
        draggedItem: null,
        startIndex: null
      },
      touchState: {
        startX: 0,
        startY: 0
      },
      playerDragState: {
        isDragging: false,
        offsetX: 0,
        offsetY: 0
      }
    };

    const elements = {
      channelsContent: document.getElementById('channelsContent'),
      noResults: document.getElementById('noResults'),
      playerContainer: document.getElementById('playerContainer'),
      playerControls: document.getElementById('playerControls'),
      videoFrame: document.getElementById('videoFrame'),
      channelInfo: document.getElementById('channelInfo'),
      prevChannelBtn: document.getElementById('prevChannelBtn'),
      nextChannelBtn: document.getElementById('nextChannelBtn'),
      toggleStickyBtn: document.getElementById('toggleStickyBtn'),
      favoriteBtn: document.getElementById('favoriteBtn'),
      closePlayerBtn: document.getElementById('closePlayerBtn'),
      searchInput: document.getElementById('searchInput'),
      filterFavorites: document.getElementById('filterFavorites'),
      filterWeb: document.getElementById('filterWeb'),
      filterAcestream: document.getElementById('filterAcestream'),
      filterSources: document.getElementById('filterSources'),
      clearFilters: document.getElementById('clearFilters'),
      emojiFilters: document.getElementById('emojiFilters'),
      settingsModal: document.getElementById('settingsModal'),
      editLinkModal: document.getElementById('editLinkModal'),
      confirmClearModal: document.getElementById('confirmClearModal'),
      confirmDeleteModal: document.getElementById('confirmDeleteModal'),
      cancelClearBtn: document.getElementById('cancelClearBtn'),
      confirmClearBtn: document.getElementById('confirmClearBtn'),
      cancelDeleteBtn: document.getElementById('cancelDeleteBtn'),
      confirmDeleteBtn: document.getElementById('confirmDeleteBtn'),
      clearAllBtn: document.getElementById('clearAllBtn'),
      editModeToggle: document.getElementById('editModeToggle'),
      rememberPlayerSize: document.getElementById('rememberPlayerSize'),
      exportLinksData: document.getElementById('exportLinksData'),
      importLinksData: document.getElementById('importLinksData'),
      copyExportLinksBtn: document.getElementById('copyExportLinksBtn'),
      downloadExportLinksBtn: document.getElementById('downloadExportLinksBtn'),
      importLinksBtn: document.getElementById('importLinksBtn'),
      importGistBtn: document.getElementById('importGistBtn'),
      importFileBtn: document.getElementById('importFileBtn'),
      cancelImportBtn: document.getElementById('cancelImportBtn'),
      closeSettingsModal: document.getElementById('closeSettingsModal'),
      editLinkUrl: document.getElementById('editLinkUrl'),
      editLinkTitle: document.getElementById('editLinkTitle'),
      editWebName: document.getElementById('editWebName'),
      editLinkSport: document.getElementById('editLinkSport'),
      editLinkLanguage: document.getElementById('editLinkLanguage'),
      editLinkType: document.getElementById('editLinkType'),
      editLinkColor: document.getElementById('editLinkColor'),
      editOpenInPlayer: document.getElementById('editOpenInPlayer'),
      editFavorito: document.getElementById('editFavorito'),
      editRatingStars: document.getElementById('editRatingStars'),
      saveEditLinkBtn: document.getElementById('saveEditLinkBtn'),
      cancelEditLinkBtn: document.getElementById('cancelEditLinkBtn'),
      closeEditLinkModal: document.getElementById('closeEditLinkModal'),
      notification: document.getElementById('notification'),
      scrollToTop: document.getElementById('scrollToTop'),
      saveEditBtn: document.getElementById('saveEditBtn'),
      playerSection: document.getElementById('playerSection'),
      colorOptions: document.querySelectorAll('#colorPicker .color-option'),
      themeSelector: document.getElementById('themeSelector'),
      notificationToggle: document.getElementById('notificationToggle'),
      autoPlayToggle: document.getElementById('autoPlayToggle'),
      defaultPlayerSize: document.getElementById('defaultPlayerSize'),
      settingsTabs: document.querySelectorAll('.settings-tab'),
      settingsContents: document.querySelectorAll('.settings-tab-content')
    };

    const classNames = {
        active: 'modal--active',
        activeFilter: 'filter-button--active',
        activeEmoji: 'emoji-filter-btn--active',
        activeTab: 'settings-tab--active',
        visibleContent: 'settings-tab-content--active',
        visibleNotification: 'notification--active',
        visibleScrollBtn: 'scroll-to-top--visible',
        editMode: 'channel-card--edit-mode',
        favoriteCard: 'channel-card--favorite',
        playerActive: 'player-container--active',
        controlsActive: 'player-controls--active',
        minimizedPlayer: 'player-container--minimized',
        minimizedControls: 'player-controls--minimized',
        collapsedHeader: 'channel-group__header--collapsed',
        collapsedContent: 'channel-group__content--collapsed',
        darkMode: 'dark-mode'
    };

    const emojis = {
        'F1': 'üèéÔ∏è',
        'Baloncesto': 'üèÄ',
        'F√∫tbol': '‚öΩ',
        'Motorsport': 'üèÅ',
        'Tenis': 'üéæ',
        'TV': 'üì∫',
        'Otros': 'üèÖ',
        'ES': 'üá™üá∏',
        'EN': 'üá¨üáß',
        'OT': 'üè≥Ô∏è‚Äç‚ößÔ∏è'
    };

    function init() {
      loadSettings();
      renderChannels();
      setupEventListeners();
      checkScrollPosition();
      window.addEventListener('storage', handleStorageEvent);
    }

    function handleStorageEvent(event) {
      if (event.key === 'daddyLiveHDLinks' || event.key === 'daddyLiveHDSettings') {
        loadSettings();
        renderChannels();
      }
    }

    function loadSettings() {
      const savedSettings = localStorage.getItem('daddyLiveHDSettings');
      if (savedSettings) {
        Object.assign(state.settings, JSON.parse(savedSettings));
      }
      
      const savedLinks = localStorage.getItem('daddyLiveHDLinks');
      if (savedLinks) {
        state.links = JSON.parse(savedLinks);
      }
      
      applyTheme(state.settings.theme);
      
      if (state.settings.rememberPlayerSize) {
        if (state.settings.playerHeight) {
          elements.playerContainer.style.height = `${state.settings.playerHeight}px`;
        }
        if (state.settings.minimizedPlayerHeight) {
          elements.playerContainer.style.height = `${state.settings.minimizedPlayerHeight}px`;
          elements.playerContainer.style.width = `${state.settings.minimizedPlayerWidth}px`;
        }
      }
      
      elements.editModeToggle.checked = state.settings.editMode;
      elements.rememberPlayerSize.checked = state.settings.rememberPlayerSize;
      elements.notificationToggle.checked = state.settings.notificationsEnabled;
      elements.autoPlayToggle.checked = state.settings.autoPlay;
      elements.defaultPlayerSize.value = state.settings.defaultPlayerSize;
      
      if (state.settings.primaryColor) {
        updatePrimaryColor(state.settings.primaryColor);
      }
    }

    function applyTheme(theme) {
      document.body.classList.remove('light-mode', 'dark-mode');
      if (theme === 'system') {
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
          document.body.classList.add('dark-mode');
          state.settings.darkMode = true;
        } else {
          document.body.classList.remove('dark-mode');
          state.settings.darkMode = false;
        }
      } else {
        document.body.classList.add(theme + '-mode');
        document.body.classList.toggle('dark-mode', theme === 'dark');
        state.settings.darkMode = theme === 'dark';
      }

      elements.themeSelector.querySelectorAll('button').forEach(btn => {
          btn.classList.toggle('active', btn.dataset.theme === theme);
      });
    }

    function updatePrimaryColor(color) {
      document.documentElement.style.setProperty('--primary', color);
      const darkerColor = shadeColor(color, -20);
      document.documentElement.style.setProperty('--primary-dark', darkerColor);
      
      const rgb = hexToRgb(color);
      if (rgb) {
        document.documentElement.style.setProperty('--primary-rgb', `${rgb.r}, ${rgb.g}, ${rgb.b}`);
      }
      
      elements.colorOptions.forEach(opt => {
        opt.classList.toggle('color-option--active', opt.dataset.color === color);
      });
    }

    function hexToRgb(hex) {
      const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result ? {
        r: parseInt(result[1], 16),
        g: parseInt(result[2], 16),
        b: parseInt(result[3], 16)
      } : null;
    }

    function saveSettings() {
      localStorage.setItem('daddyLiveHDSettings', JSON.stringify(state.settings));
      localStorage.setItem('daddyLiveHDLinks', JSON.stringify(state.links));
    }

    function clearAllData() {
      state.links = [];
      state.settings = {
        darkMode: false,
        primaryColor: '#2563eb',
        rememberPlayerSize: true,
        playerHeight: 400,
        minimizedPlayerHeight: 180,
        minimizedPlayerWidth: 320,
        expandedGroups: {},
        editMode: false,
        notificationsEnabled: true,
        autoPlay: true,
        defaultPlayerSize: 400,
        theme: 'system'
      };
      
      localStorage.removeItem('daddyLiveHDSettings');
      localStorage.removeItem('daddyLiveHDLinks');
      
      applyTheme('system');
      elements.editModeToggle.checked = false;
      elements.rememberPlayerSize.checked = true;
      elements.notificationToggle.checked = true;
      elements.autoPlayToggle.checked = true;
      elements.defaultPlayerSize.value = 400;
      updatePrimaryColor('#2563eb');
      
      state.filters = {
        searchText: '',
        type: 'web',
        sport: null,
        language: null,
        favoritesOnly: false
      };
      
      elements.searchInput.value = '';
      updateTypeFilterButtons();
      updateEmojiFilterButtons();
      elements.filterFavorites.classList.remove(classNames.activeFilter);
      
      closePlayer();
      renderChannels();
      
      if (state.settings.notificationsEnabled) {
        showNotification('Todos los datos han sido borrados');
      }
    }

    function deleteLink(linkId) {
      state.links = state.links.filter(link => link.id !== linkId);
      saveSettings();
      renderChannels();
      if (state.settings.notificationsEnabled) {
        showNotification('Enlace eliminado');
      }
    }

    function renderChannels() {
      const filteredLinks = state.links.filter(link => {
        const searchLower = state.filters.searchText.toLowerCase();
        const matchesSearch = !state.filters.searchText || link.title.toLowerCase().includes(searchLower) || (link.webName?.toLowerCase().includes(searchLower));
        const matchesType = !state.filters.type || link.type === state.filters.type;
        const matchesSport = !state.filters.sport || link.deporte === state.filters.sport;
        const matchesLanguage = !state.filters.language || link.idioma === state.filters.language;
        const matchesFavorites = !state.filters.favoritesOnly || link.favorito;
        
        return matchesSearch && matchesType && matchesSport && matchesLanguage && matchesFavorites;
      });
      
      const linksByTitle = filteredLinks.reduce((acc, link) => {
        if (!acc[link.title]) {
          acc[link.title] = [];
        }
        acc[link.title].push(link);
        return acc;
      }, {});
      
      if (Object.keys(linksByTitle).length === 0) {
        elements.noResults.style.display = 'block';
        elements.channelsContent.innerHTML = '';
        return;
      }
      
      elements.noResults.style.display = 'none';
      
      const html = Object.entries(linksByTitle).map(([title, links]) => {
        const groupId = `group-${title.replace(/\s+/g, '-').toLowerCase()}`;
        const isExpanded = state.settings.expandedGroups[groupId] !== false;
        
        const cardsHtml = links.map(renderLinkCard).join('');
        
        return `
          <div class="channel-group" id="${groupId}">
            <div class="channel-group__header ${isExpanded ? '' : classNames.collapsedHeader}">
              <div class="channel-group__title">${title}</div>
            </div>
            <div class="channel-group__content ${isExpanded ? '' : classNames.collapsedContent}">
              ${cardsHtml}
            </div>
          </div>
        `;
      }).join('');
      
      elements.channelsContent.innerHTML = html;
      
      document.querySelectorAll('.channel-group__header').forEach(header => {
        header.addEventListener('click', function() {
          const groupId = this.parentElement.id;
          const content = this.nextElementSibling;
          
          content.classList.toggle(classNames.collapsedContent);
          this.classList.toggle(classNames.collapsedHeader);
          
          state.settings.expandedGroups[groupId] = !content.classList.contains(classNames.collapsedContent);
          saveSettings();
        });
      });
      
      elements.saveEditBtn.classList.toggle('save-edit-btn--visible', state.settings.editMode);
    }

    function renderLinkCard(link) {
      const editModeClass = state.settings.editMode ? classNames.editMode : '';
      const languageFlag = emojis[link.idioma] || emojis['OT'];
      
      return `
        <div class="channel-card ${link.favorito ? classNames.favoriteCard : ''} ${editModeClass}" 
             data-id="${link.id}"
             style="${link.color ? `border-color: ${link.color}` : ''}">
          <button class="delete-btn" data-id="${link.id}" title="Borrar enlace">√ó</button>
          <button class="edit-btn" data-id="${link.id}" title="Editar enlace">‚úèÔ∏è</button>
          ${link.idioma ? `<span class="channel-language">${languageFlag}</span>` : ''}
          <div class="channel-header">
            <div class="channel-name">${link.webName || link.title}</div>
          </div>
          <div class="channel-sport">${emojis[link.deporte] || ''}</div>
          ${link.puntuacion ? `<div class="channel-rating">${'‚òÖ'.repeat(link.puntuacion)}${'‚òÜ'.repeat(5 - link.puntuacion)}</div>` : ''}
        </div>
      `;
    }
    
    function openLink(linkId) {
      if (state.settings.editMode) return;
      
      const link = state.links.find(l => l.id === linkId);
      if (!link) return;
      
      if (link.openInPlayer) {
        state.currentPlayer.channelId = linkId;
        
        elements.channelInfo.textContent = link.title;
        elements.favoriteBtn.classList.toggle('control-btn--active', link.favorito);
        
        elements.videoFrame.src = link.link;
        
        elements.playerContainer.classList.add(classNames.playerActive);
        elements.playerControls.classList.add(classNames.controlsActive);
        elements.playerSection.scrollIntoView({ behavior: 'smooth' });
        
        if (state.settings.rememberPlayerSize) {
          elements.playerContainer.style.height = state.currentPlayer.isMinimized
            ? `${state.settings.minimizedPlayerHeight}px`
            : `${state.settings.playerHeight}px`;
          elements.playerContainer.style.width = state.currentPlayer.isMinimized
            ? `${state.settings.minimizedPlayerWidth}px`
            : '100%';
        }
      } else {
        window.open(link.link, '_blank');
      }
    }

    function closePlayer() {
      elements.playerContainer.classList.remove(classNames.playerActive);
      elements.playerControls.classList.remove(classNames.controlsActive);
      state.currentPlayer.channelId = null;
      
      if (state.currentPlayer.isMinimized) {
        toggleMinimizePlayer();
      }
    }

    function toggleMinimizePlayer() {
      state.currentPlayer.isMinimized = !state.currentPlayer.isMinimized;
      
      elements.playerContainer.classList.toggle(classNames.minimizedPlayer, state.currentPlayer.isMinimized);
      elements.playerControls.classList.toggle(classNames.minimizedControls, state.currentPlayer.isMinimized);
      elements.toggleStickyBtn.classList.toggle('control-btn--active', state.currentPlayer.isMinimized);
      
      if (state.settings.rememberPlayerSize) {
        if (state.currentPlayer.isMinimized) {
          state.settings.playerHeight = elements.playerContainer.offsetHeight;
          elements.playerContainer.style.height = `${state.settings.minimizedPlayerHeight}px`;
          elements.playerContainer.style.width = `${state.settings.minimizedPlayerWidth}px`;
        } else {
          state.settings.minimizedPlayerHeight = elements.playerContainer.offsetHeight;
          state.settings.minimizedPlayerWidth = elements.playerContainer.offsetWidth;
          elements.playerContainer.style.height = `${state.settings.playerHeight}px`;
          elements.playerContainer.style.width = '100%';
        }
      }
      
      saveSettings();
    }

    function toggleFavorite() {
      if (!state.currentPlayer.channelId) return;
      
      const link = state.links.find(l => l.id === state.currentPlayer.channelId);
      if (link) {
        link.favorito = !link.favorito;
        elements.favoriteBtn.classList.toggle('control-btn--active', link.favorito);
        
        const linkCard = document.querySelector(`.channel-card[data-id="${link.id}"]`);
        if (linkCard) {
          linkCard.classList.toggle(classNames.favoriteCard, link.favorito);
        }
        
        if (state.settings.notificationsEnabled) {
          showNotification(link.favorito ? 'A√±adido a favoritos' : 'Eliminado de favoritos');
        }
        saveSettings();
      }
    }

    function resizePlayer(direction) {
      if (!elements.playerContainer.classList.contains(classNames.playerActive)) return;
      
      const isMinimized = state.currentPlayer.isMinimized;
      const currentHeight = elements.playerContainer.offsetHeight;
      const step = isMinimized ? 20 : 50;
      
      let newHeight;
      if (direction === 'increase') {
        newHeight = currentHeight + step;
      } else {
        newHeight = currentHeight - step;
      }
      
      let newWidth = elements.playerContainer.offsetWidth;
      if (isMinimized) {
        newHeight = Math.max(120, Math.min(newHeight, 300));
        newWidth = Math.round(newHeight * 16/9);
      } else {
        newHeight = Math.max(311, Math.min(newHeight, window.innerHeight * 0.85));
      }
      
      elements.playerContainer.style.height = `${newHeight}px`;
      elements.playerContainer.style.width = `${newWidth}px`;
      
      if (state.settings.rememberPlayerSize) {
        if (isMinimized) {
          state.settings.minimizedPlayerHeight = newHeight;
          state.settings.minimizedPlayerWidth = newWidth;
        } else {
          state.settings.playerHeight = newHeight;
        }
      }
      
      saveSettings();
    }

    function showNotification(message, type = 'success') {
      if (!state.settings.notificationsEnabled) return;
      elements.notification.textContent = message;
      elements.notification.className = `notification notification--${type}`;
      elements.notification.classList.add(classNames.visibleNotification);
      
      setTimeout(() => {
        elements.notification.classList.remove(classNames.visibleNotification);
      }, 3000);
    }

    function checkScrollPosition() {
      elements.scrollToTop.classList.toggle(classNames.visibleScrollBtn, window.scrollY > 300);
    }

    function editLink(linkId) {
      const link = state.links.find(l => l.id === linkId);
      if (!link) return;
      
      state.editState.linkId = linkId;
      
      elements.editLinkUrl.value = link.link;
      elements.editLinkTitle.value = link.title;
      elements.editWebName.value = link.webName || '';
      elements.editLinkSport.value = link.deporte;
      elements.editLinkLanguage.value = link.idioma;
      elements.editLinkType.value = link.type;
      elements.editLinkColor.value = link.color || '#2563eb';
      elements.editOpenInPlayer.checked = link.openInPlayer || false;
      elements.editFavorito.checked = link.favorito || false;
      
      const stars = elements.editRatingStars.querySelectorAll('.star');
      stars.forEach((star, index) => {
        star.classList.toggle('active', index < (link.puntuacion || 0));
      });
      
      elements.editLinkModal.classList.add(classNames.active);
    }

    function saveEditedLink() {
      const linkId = state.editState.linkId;
      const activeStars = elements.editRatingStars.querySelectorAll('.star.active');
      const rating = activeStars.length;

      if (!elements.editLinkUrl.value || !elements.editLinkTitle.value) {
        if (state.settings.notificationsEnabled) {
          showNotification('URL y t√≠tulo son obligatorios', 'error');
        }
        return;
      }

      const linkData = {
        id: linkId || generateShortId(),
        link: elements.editLinkUrl.value,
        title: elements.editLinkTitle.value,
        webName: elements.editWebName.value || null,
        deporte: elements.editLinkSport.value,
        idioma: elements.editLinkLanguage.value,
        type: elements.editLinkType.value,
        color: elements.editLinkColor.value,
        openInPlayer: elements.editOpenInPlayer.checked,
        favorito: elements.editFavorito.checked,
        puntuacion: rating
      };

      if (linkId) {
        const index = state.links.findIndex(l => l.id === linkId);
        if (index !== -1) {
          Object.assign(state.links[index], linkData);
          if (state.settings.notificationsEnabled) {
            showNotification('Enlace actualizado correctamente');
          }
        }
      } else {
        state.links.push(linkData);
        if (state.settings.notificationsEnabled) {
          showNotification('Nuevo enlace a√±adido');
        }
      }

      saveSettings();
      renderChannels();
      closeEditLinkModal();
    }

    function handleFilterButtonClick(buttonId) {
      const now = Date.now();
      const isSameButton = state.filterClicks.lastClickedButton === buttonId;
      const isQuickClick = now - state.filterClicks.lastClickTime < 1000;
      
      state.filterClicks.lastClickedButton = buttonId;
      state.filterClicks.lastClickTime = now;
      state.filterClicks.count = (isSameButton && isQuickClick) ? state.filterClicks.count + 1 : 1;
      
      if (state.filterClicks.count >= 3 && buttonId !== 'clearFilters') {
        state.editState.linkId = null;
        Object.values(elements).forEach(el => {
            if(el.value !== undefined) el.value = '';
            if(el.type === 'checkbox') el.checked = false;
        });
        
        elements.editLinkSport.value = 'F√∫tbol';
        elements.editLinkLanguage.value = 'ES';
        elements.editLinkType.value = buttonId === 'filterWeb' ? 'web' : 
                                      buttonId === 'filterAcestream' ? 'acestream' : 'source';
        elements.editLinkColor.value = '#2563eb';
        
        elements.editRatingStars.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
        
        elements.editLinkModal.classList.add(classNames.active);
        state.filterClicks.count = 0;
      } else if (buttonId === 'clearFilters') {
          if(state.filterClicks.count >= 3) {
            elements.exportLinksData.value = JSON.stringify(state.links, null, 2);
            elements.settingsModal.classList.add(classNames.active);
            state.filterClicks.count = 0;
          } else {
            state.filters = {
              searchText: '',
              type: 'web',
              sport: null,
              language: null,
              favoritesOnly: false
            };
            
            elements.searchInput.value = '';
            updateTypeFilterButtons();
            updateEmojiFilterButtons();
            elements.filterFavorites.classList.remove(classNames.activeFilter);
            
            renderChannels();
          }
      } else {
        state.filters.type = buttonId.replace('filter', '').toLowerCase();
        updateTypeFilterButtons();
        renderChannels();
      }
    }

    function handleEmojiFilterClick(emojiBtn) {
        const filterType = emojiBtn.dataset.filter;
        const isLang = ['ES', 'EN'].includes(filterType);
        const filterStateKey = isLang ? 'language' : 'sport';
        
        if (state.filters[filterStateKey] === filterType) {
            state.filters[filterStateKey] = null;
        } else {
            state.filters[filterStateKey] = filterType;
        }
        
        updateEmojiFilterButtons();
        renderChannels();
    }

    function handleSwipe(direction) {
      const filterOrder = ['web', 'acestream', 'source'];
      const currentIndex = filterOrder.indexOf(state.filters.type);
      let newIndex = (currentIndex + (direction === 'left' ? 1 : -1) + filterOrder.length) % filterOrder.length;
      
      state.filters.type = filterOrder[newIndex];
      updateTypeFilterButtons();
      renderChannels();
    }
    
    async function importFromGist() {
      try {
        const gistId = 'be82cec2fed5b9886b07fc171f2d9744';
        const rawUrl = `https://gist.githubusercontent.com/Ciento20/${gistId}/raw`;
        
        const response = await fetch(rawUrl);
        if (!response.ok) throw new Error('Error al obtener los datos del Gist');
        
        const data = await response.json();
        if (!Array.isArray(data)) throw new Error('Los datos del Gist no son v√°lidos');
        
        const normalizedData = data.map(item => ({
          id: generateShortId(),
          link: item.link || item.url || '',
          title: item.title || item.name || 'Sin t√≠tulo',
          webName: item.webName || item.source || null,
          deporte: item.deporte || item.sport || 'Otros',
          type: item.type || 'web',
          idioma: item.idioma || item.language || 'ES',
          color: item.color || '#2563eb',
          openInPlayer: item.openInPlayer || false,
          puntuacion: item.puntuacion || item.rating || 3,
          favorito: item.favorito || false
        })).filter(item => item.link);
        
        if (normalizedData.length === 0) {
          if (state.settings.notificationsEnabled) {
            showNotification('El Gist no contiene enlaces v√°lidos', 'error');
          }
          return;
        }
        
        state.links = normalizedData;
        saveSettings();
        renderChannels();
        closeSettingsModal();
        if (state.settings.notificationsEnabled) {
          showNotification(`Se importaron ${normalizedData.length} enlaces desde el Gist`);
        }
      } catch (error) {
        if (state.settings.notificationsEnabled) {
          showNotification(`Error al importar desde Gist: ${error.message}`, 'error');
        }
        console.error('Error al importar desde Gist:', error);
      }
    }

    function generateShortId() {
      return Math.random().toString(36).substr(2, 9);
    }
    
    function setupDragAndDrop() {
      const isElement = el => el instanceof Element;
      
      document.addEventListener('mousedown', e => {
        const card = e.target.closest('.channel-card');
        if (!state.settings.editMode || !card) return;
        
        state.dragState.isDragging = true;
        state.dragState.draggedItem = card;
        state.dragState.startIndex = state.links.findIndex(l => l.id === card.dataset.id);
        
        card.style.opacity = '0.5';
        card.style.transform = 'rotate(2deg)';
        e.preventDefault();
      });
      
      document.addEventListener('mousemove', e => {
        if (!state.dragState.isDragging || !state.dragState.draggedItem) return;
        
        const target = e.target.closest('.channel-card');
        if (target && target !== state.dragState.draggedItem) {
          const targetIndex = state.links.findIndex(l => l.id === target.dataset.id);
          const draggedLink = state.links.splice(state.dragState.startIndex, 1)[0];
          state.links.splice(targetIndex, 0, draggedLink);
          state.dragState.startIndex = targetIndex;
          renderChannels();
        }
      });
      
      document.addEventListener('mouseup', () => {
        if (state.dragState.isDragging) {
          state.dragState.isDragging = false;
          state.dragState.draggedItem.style.opacity = '';
          state.dragState.draggedItem.style.transform = '';
          state.dragState.draggedItem = null;
          saveSettings();
          if (state.settings.notificationsEnabled) {
            showNotification('Orden de canales guardado');
          }
        }
      });
    }

    function setupPlayerDrag() {
      const playerContainer = elements.playerContainer;
      const playerControls = elements.playerControls;
      const channelInfo = elements.channelInfo;

      const handleStartDrag = (e) => {
        if (!state.currentPlayer.isMinimized) return;
        state.playerDragState.isDragging = true;
        const rect = playerContainer.getBoundingClientRect();
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        state.playerDragState.offsetX = clientX - rect.left;
        state.playerDragState.offsetY = clientY - rect.top;
        document.body.style.userSelect = 'none';
        playerContainer.style.transition = 'none';
        e.preventDefault();
      };

      const handleDrag = (e) => {
        if (!state.playerDragState.isDragging) return;
        const clientX = e.clientX || e.touches[0].clientX;
        const clientY = e.clientY || e.touches[0].clientY;
        let x = clientX - state.playerDragState.offsetX;
        let y = clientY - state.playerDragState.offsetY;

        const maxX = window.innerWidth - playerContainer.offsetWidth;
        const maxY = window.innerHeight - playerContainer.offsetHeight;
        x = Math.max(0, Math.min(x, maxX));
        y = Math.max(0, Math.min(y, maxY));

        playerContainer.style.left = `${x}px`;
        playerContainer.style.top = `${y}px`;
        playerControls.style.left = `${x}px`;
        playerControls.style.bottom = `${window.innerHeight - y - playerContainer.offsetHeight - 60}px`;
      };

      const handleEndDrag = () => {
        state.playerDragState.isDragging = false;
        document.body.style.userSelect = '';
        playerContainer.style.transition = 'all 0.3s ease';
      };

      channelInfo.addEventListener('mousedown', handleStartDrag);
      channelInfo.addEventListener('touchstart', handleStartDrag, { passive: false });
      document.addEventListener('mousemove', handleDrag);
      document.addEventListener('touchmove', handleDrag, { passive: false });
      document.addEventListener('mouseup', handleEndDrag);
      document.addEventListener('touchend', handleEndDrag);
    }
    
    function setupTouchEvents() {
      document.addEventListener('touchstart', (e) => {
        state.touchState.startX = e.changedTouches[0].screenX;
        state.touchState.startY = e.changedTouches[0].screenY;
      }, { passive: true });
      
      document.addEventListener('touchend', (e) => {
        const endX = e.changedTouches[0].screenX;
        const endY = e.changedTouches[0].screenY;
        const diffX = endX - state.touchState.startX;
        const diffY = endY - state.touchState.startY;
        
        if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
          handleSwipe(diffX > 0 ? 'right' : 'left');
        }
      }, { passive: true });
    }
    
    function setupModalEvents() {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.addEventListener('click', (e) => {
          if (e.target.classList.contains('modal')) {
            modal.classList.remove(classNames.active);
          }
        });
      });
    }

    function setupEventListeners() {
      setupTouchEvents();
      setupPlayerDrag();
      setupDragAndDrop();
      setupModalEvents();

      document.addEventListener('click', (e) => {
        const { target } = e;
        const deleteBtn = target.closest('.delete-btn');
        const editBtn = target.closest('.edit-btn');
        const linkCard = target.closest('.channel-card');
        
        if (deleteBtn) {
          e.stopPropagation();
          state.deleteState.linkId = deleteBtn.dataset.id;
          elements.confirmDeleteModal.classList.add(classNames.active);
        } else if (editBtn) {
          e.stopPropagation();
          editLink(editBtn.dataset.id);
        } else if (linkCard && !state.settings.editMode) {
          openLink(linkCard.dataset.id);
        }
      });

      elements.confirmDeleteBtn.addEventListener('click', () => {
        elements.confirmDeleteModal.classList.remove(classNames.active);
        if (state.deleteState.linkId) deleteLink(state.deleteState.linkId);
      });
      elements.cancelDeleteBtn.addEventListener('click', () => elements.confirmDeleteModal.classList.remove(classNames.active));

      elements.prevChannelBtn.addEventListener('click', () => resizePlayer('decrease'));
      elements.nextChannelBtn.addEventListener('click', () => resizePlayer('increase'));
      elements.toggleStickyBtn.addEventListener('click', toggleMinimizePlayer);
      elements.favoriteBtn.addEventListener('click', toggleFavorite);
      elements.closePlayerBtn.addEventListener('click', closePlayer);
      
      elements.searchInput.addEventListener('input', () => {
        state.filters.searchText = elements.searchInput.value;
        renderChannels();
      });

      elements.filterFavorites.addEventListener('click', () => {
        state.filters.favoritesOnly = !state.filters.favoritesOnly;
        elements.filterFavorites.classList.toggle(classNames.activeFilter, state.filters.favoritesOnly);
        renderChannels();
      });

      elements.filterWeb.addEventListener('click', () => handleFilterButtonClick('filterWeb'));
      elements.filterAcestream.addEventListener('click', () => handleFilterButtonClick('filterAcestream'));
      elements.filterSources.addEventListener('click', () => handleFilterButtonClick('filterSources'));
      elements.clearFilters.addEventListener('click', () => handleFilterButtonClick('clearFilters'));

      elements.emojiFilters.addEventListener('click', (e) => {
        const emojiBtn = e.target.closest('.emoji-filter-btn');
        if (emojiBtn) handleEmojiFilterClick(emojiBtn);
      });
      
      elements.closeSettingsModal.addEventListener('click', () => elements.settingsModal.classList.remove(classNames.active));
      elements.editModeToggle.addEventListener('change', () => {
        state.settings.editMode = elements.editModeToggle.checked;
        saveSettings();
        renderChannels();
        if (state.settings.notificationsEnabled) {
          showNotification('Modo edici√≥n ' + (state.settings.editMode ? 'activado' : 'desactivado'));
        }
      });

      elements.notificationToggle.addEventListener('change', () => {
        state.settings.notificationsEnabled = elements.notificationToggle.checked;
        saveSettings();
        if (state.settings.notificationsEnabled) {
          showNotification('Notificaciones activadas');
        }
      });
      
      elements.rememberPlayerSize.addEventListener('change', () => {
        state.settings.rememberPlayerSize = elements.rememberPlayerSize.checked;
        saveSettings();
        if (state.settings.notificationsEnabled) {
          showNotification('Recordar tama√±o ' + (state.settings.rememberPlayerSize ? 'activado' : 'desactivado'));
        }
      });

      elements.autoPlayToggle.addEventListener('change', () => {
        state.settings.autoPlay = elements.autoPlayToggle.checked;
        saveSettings();
        if (state.settings.notificationsEnabled) {
          showNotification('Reproducci√≥n autom√°tica ' + (state.settings.autoPlay ? 'activada' : 'desactivada'));
        }
      });
      
      elements.defaultPlayerSize.addEventListener('change', () => {
        state.settings.defaultPlayerSize = parseInt(elements.defaultPlayerSize.value, 10);
        saveSettings();
        if (state.settings.notificationsEnabled) {
          showNotification('Tama√±o predeterminado del reproductor actualizado');
        }
      });

      elements.themeSelector.addEventListener('click', (e) => {
        const themeBtn = e.target.closest('button');
        if (themeBtn) {
          state.settings.theme = themeBtn.dataset.theme;
          applyTheme(state.settings.theme);
          saveSettings();
          if (state.settings.notificationsEnabled) {
            showNotification('Tema actualizado');
          }
        }
      });
      
      elements.colorOptions.forEach(option => {
        option.addEventListener('click', () => {
          const color = option.dataset.color;
          state.settings.primaryColor = color;
          updatePrimaryColor(color);
          saveSettings();
          if (state.settings.notificationsEnabled) {
            showNotification('Color principal actualizado');
          }
        });
      });
      
      elements.settingsTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const tabName = this.dataset.tab;
          elements.settingsTabs.forEach(t => t.classList.remove(classNames.activeTab));
          this.classList.add(classNames.activeTab);
          elements.settingsContents.forEach(c => c.classList.remove(classNames.visibleContent));
          document.getElementById(`${tabName}Tab`).classList.add(classNames.visibleContent);
        });
      });
      
      elements.copyExportLinksBtn.addEventListener('click', () => {
        elements.exportLinksData.select();
        document.execCommand('copy');
        if (state.settings.notificationsEnabled) {
          showNotification('¬°Copiado!');
        }
      });

      elements.downloadExportLinksBtn.addEventListener('click', () => {
        const data = elements.exportLinksData.value;
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'daddy_links.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        if (state.settings.notificationsEnabled) {
          showNotification('Archivo JSON descargado');
        }
      });
      
      elements.importLinksBtn.addEventListener('click', () => {
        try {
          const data = JSON.parse(elements.importLinksData.value);
          if (!Array.isArray(data)) throw new Error('Formato de datos inv√°lido');
          
          const newLinks = data.map(item => ({
            id: generateShortId(),
            link: item.link,
            title: item.title || 'Sin t√≠tulo',
            webName: item.webName || null,
            deporte: item.deporte || 'Otros',
            type: item.type || 'web',
            idioma: item.idioma || 'ES',
            color: item.color || '#2563eb',
            openInPlayer: item.openInPlayer || false,
            puntuacion: item.puntuacion || 3,
            favorito: item.favorito || false
          })).filter(item => item.link);
          
          const uniqueNewLinks = newLinks.filter(newLink => 
            !state.links.some(existingLink => existingLink.link === newLink.link)
          );
          
          if (uniqueNewLinks.length > 0) {
            state.links = [...state.links, ...uniqueNewLinks];
            saveSettings();
            renderChannels();
            closeSettingsModal();
            if (state.settings.notificationsEnabled) {
              showNotification(`Se a√±adieron ${uniqueNewLinks.length} nuevos enlaces`);
            }
          } else {
            if (state.settings.notificationsEnabled) {
              showNotification('No se encontraron enlaces nuevos para importar', 'info');
            }
          }
        } catch (e) {
          if (state.settings.notificationsEnabled) {
            showNotification('Error al importar datos: JSON inv√°lido', 'error');
          }
        }
      });
      
      elements.importGistBtn.addEventListener('click', importFromGist);

      elements.importFileBtn.addEventListener('click', () => {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = e => {
          const file = e.target.files[0];
          if (!file) return;
          const reader = new FileReader();
          reader.onload = function(event) {
            elements.importLinksData.value = event.target.result;
            if (state.settings.notificationsEnabled) {
              showNotification('Archivo cargado en el campo de texto');
            }
          };
          reader.readAsText(file);
        };
        input.click();
      });
      
      elements.cancelImportBtn.addEventListener('click', () => elements.importLinksData.value = '');
      
      elements.saveEditBtn.addEventListener('click', () => {
        state.settings.editMode = false;
        elements.editModeToggle.checked = false;
        saveSettings();
        renderChannels();
        if (state.settings.notificationsEnabled) {
          showNotification('Cambios guardados');
        }
      });
      
      elements.clearAllBtn.addEventListener('click', () => elements.confirmClearModal.classList.add(classNames.active));
      elements.cancelClearBtn.addEventListener('click', () => elements.confirmClearModal.classList.remove(classNames.active));
      elements.confirmClearBtn.addEventListener('click', () => {
        elements.confirmClearModal.classList.remove(classNames.active);
        clearAllData();
      });
      
      elements.closeEditLinkModal.addEventListener('click', () => elements.editLinkModal.classList.remove(classNames.active));
      elements.cancelEditLinkBtn.addEventListener('click', () => elements.editLinkModal.classList.remove(classNames.active));
      elements.saveEditLinkBtn.addEventListener('click', saveEditedLink);
      
      elements.editRatingStars.addEventListener('click', (e) => {
        const star = e.target.closest('.star');
        if (star) {
          const value = parseInt(star.dataset.value);
          elements.editRatingStars.querySelectorAll('.star').forEach((s, index) => {
            s.classList.toggle('active', index < value);
          });
        }
      });
      
      window.addEventListener('scroll', checkScrollPosition);
      elements.scrollToTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    }

    function updateTypeFilterButtons() {
      const type = state.filters.type;
      elements.filterWeb.classList.toggle(classNames.activeFilter, type === 'web');
      elements.filterAcestream.classList.toggle(classNames.activeFilter, type === 'acestream');
      elements.filterSources.classList.toggle(classNames.activeFilter, type === 'source');
    }

    function updateEmojiFilterButtons() {
      document.querySelectorAll('.emoji-filter-btn').forEach(btn => {
        const filterType = btn.dataset.filter;
        const isLang = ['ES', 'EN'].includes(filterType);
        const filterStateValue = isLang ? state.filters.language : state.filters.sport;
        btn.classList.toggle(classNames.activeEmoji, filterStateValue === filterType);
      });
    }

    function shadeColor(color, percent) {
      let R = parseInt(color.substring(1,3), 16);
      let G = parseInt(color.substring(3,5), 16);
      let B = parseInt(color.substring(5,7), 16);

      R = parseInt(R * (100 + percent) / 100);
      G = parseInt(G * (100 + percent) / 100);
      B = parseInt(B * (100 + percent) / 100);

      R = (R<255)?R:255;  
      G = (G<255)?G:255;  
      B = (B<255)?B:255;  

      const RR = ((R.toString(16).length===1)?"0"+R.toString(16):R.toString(16));
      const GG = ((G.toString(16).length===1)?"0"+G.toString(16):G.toString(16));
      const BB = ((B.toString(16).length===1)?"0"+B.toString(16):B.toString(16));

      return "#"+RR+GG+BB;
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
